# Ch 9. 디폴트 메서드

Java 8 in Action :: Contents

# Preview

---

인터페이스를 구현하는 클래스는 인터페이스의 모든 메서드를 구현하거나 super 클래스를 상속받아야 한다. 문제는 인터페이스에 새로운 메서드가 추가되면, 해당 인터페이스를 구현한 모든 클래스가 수정되어야 한다는 점이다. 예를 들어, 자바API의 List 인터페이스가 수정된다 가정해보라 - 전세계의 코드들이 모두 수정되야한다.

이를 해결하기 위해, 자바8에서 2가지 방안이 등장했다.

1. static method

    이전까진 유틸리티 클래스로 별도로 구현해 사용했지만, 자바8에선 인터페이스 내부에 직접 정적 메서드를 구현할 수 있다.

2. default method

    자바8에선 메서드 구현을 포함하는 인터페이스를 구현할 수 있으며, 결과적으로 해당 인터페이스를 구현하는 클래스들은 자동으로 추가된 새로운 디폴트 메서드를 상속받게 된다.

그러면 결국 인터페이스가 아닌, 추상클래스가 되버린것 아닌가? 비슷한 점이 많아졌지만 여전히 다른점이 있으며, 이에 대해 뒤에서 설명한다.

default method는 주로 라이브러리 설계자들이 이용하며, 이를 통해 자바 API의 호환성을 유지하며 라이브러리를 바꿀 수 있다.

이 장에서 살펴볼 내용은 다음과 같다.

> - API가 바뀌며 어떤 문제가 생기는지 확인
- Default Method가 무엇이고, 문제를 어떻게 해결하는지
- default method를 만들어, 다중 상속을 달성하는 방법
- 같은 시그니처를 갖는 여러 default method를 상속받으며 발생하는 모호성 문제를 자바 컴파일러가 어떻게 해결하는지

# 변화하는 API

---

결국 API를 수정하는 것은 기존 모든 코드를 고쳐야 하므로 쉽지 않다는 내용

→ default method를 이용해 이 문제를 해결한다

- 호환성 문제는 크게 3가지로 분류할 수 있다
    1. 바이너리 호환성 : 수정후에도, 에러없이 기존 바이너리가 실행가능한 상황 (호출안하면 ㄱㅊ, 문제 일단은 발생 안함)
    2. 소스 호환성 : 수정후에도, 기존 프로그램을 성공적으로 재컴파일할 수 있는 상황 (호출안해도 컴파일 문제 발)
    3. 동작 호환성 : 수정후에도, 같은 입력값이 주어지면 프로그램이 같은 동작을 실행하는 상황

# 디폴트 메서드란 무엇인가?

---

`default` 키워드로 시작하며, 다른 클래스에 선언된 메서드처럼 메서드 바디를 포함한다

    public interface Sized {
    		int size();
    		default boolean isEmpty() {
    				return size() == 0;
    		}
    }

### 추상 클래스 vs 자바8의 인터페이스

둘다 추상 메서드와 바디를 포함하는 메서드를 정의할 수 있다.

1. 클래스는 하나의 추상 클래스만 상속받을 수 있지만, 인터페이스는 여러개 구현할 수 있다
2. 추상 클래스는 인스턴스 변수(필드)로 공통 상태를 가질 수 있다. 하지만 인터페이스는 가질 수 없다

# 디폴트 메서드 활용 패턴

---

디폴트 메서드를 이용해, 라이브러리를 바꿔도 호환성을 유지할 수 있다는 걸 확인했다.

이번엔 디폴트 메서드를 활용하는 다른 2가지 방식도 살펴본다.

1. 선택형 메서드 (Optional method)

    Iterator 인터페이스를 예로 들면, remove 메서드는 잘 사용되지 않아 Iterator를 구현하는 많은 클래스들에서 remove에 빈 구현을 반복했다. 자바8부터 디폴트 메서드를 이용해 remove의 기본 구현을 제공하며, 클래스에서 빈 구현을 할 필요 없어져 불필요한 코드를 줄일 수 있게 되었다.

2. 동작 다중 상속 (Multiple Inheritance of Behavior)

    디폴트 메서드를 이용해 기존에 불가능했던 동작 다중 상속 기능도 구현할 수 있다. 자바의 클래스는 한개만 상속할 수 있지만 인터페이스는 여러개 구현할 수 있다. 자바8부턴 인터페이스가 구현을 포함할 수 있으므로, 클래스가 여러 인터페이스들에서 동작을 상속받을 수 있다.

# 해석 규칙

---

> C++의 다이아몬드 문제 :
같은 디폴트 메서드 시그니처를 갖는 여러 메서드를 상속받는 문제

교재를 차례대로 읽어나가면 이해됨.

C++은 클래스의 다중 상속을 지원한다. 반면 자바는 하나의 부모 클래스만 상속받을 수 있다. 대신 여러 인터페이스를 동시에 구현할 수 있다.

자바8부터 디폴트 메서드가 추가되면서, 같은 시그니처를 갖는 디폴트 메서드를 상속받는 상황이 생길 수 있다. 이땐 어느 것을 선택해야 할까?

자주 일어나는 일은 아니지만 이를 해결할 규칙이 존재한다.

1. 클래스가 항상 이긴다. 클래스나 슈퍼클래스에서 정의한 메서드가 디폴트 메서드보다 우선권을 갖는다
2. 1번 규칙 외의 상황에서는 서브인터페이스가 이긴다. 즉 B가 A를 상속받는다면, B가 A를 이긴다
3. 여전히 우선순위가 결정되지 않았다면, 디폴트 메서드를 오버라이드하거나 명시적으로 선택하여 호출해야 한다. 그렇지 않으면 에러 발생