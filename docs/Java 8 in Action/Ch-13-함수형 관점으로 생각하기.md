# Ch 13. 함수형 관점으로 생각하기

Java 8 in Action :: Contents

함수형(Functional)이란 뭘까?
일급 함수와 관련있고, 때로는 객체변화를 제한하는것과 관련있다
부작용, 불변성, 선언형 프로그래밍, 참조 투명성, 자바8의 기능 등 FP에 대해 알아보자

# 요약

---

- 공유된 가변 자료구조를 줄이는 것은 장기적으로 프로그램을 유지보수하고 디버깅하는데 도움이 된다
- FP는 부작용이 없는 메서드와 선언형 프로그래밍 방식을 지향한다
- 함수형 메서드는 입력인수와 출력결과만을 갖는다
- 같은 인수값으로 함수를 호출했을 때 항상 같은 결과를 반환하면 참조투명성을 갖는 함수다. while 루프 같은 반복문은 재귀로 대체할 수 있다
- 자바에선 고전방식의 재귀보다 꼬리재귀를 사용해야 추가적인 컴파일러 최적화를 기대할 수 있다

# 시스템 구현과 유지보수

---

- FP는 No Side Effect(부작용 없음)와 Immutability(불변성)를 제공한다
- Pure method (= Side-Effect free method) : 자신과 다른 클래스의 상태를 바꾸지않고, return문을 통해서만 결과를 반환하는 메서드
- Side Effect : 자료구조를 고치거나 필드에 값 할당(setter제외), 예외 발생, 파일 IO 동작 등...

    → 불변객체를 통해 부작용을 없앨수도 있다

- 명령형 프로그래밍 : 고전 객체지향에서 이용
- 선언형 프로그래밍 : ex) FP

# 함수형 프로그래밍이란 무엇인가 ?

---

FP의 '함수'는 수학의 함수. 0개 이상의 인수를 갖고 한개 이상의 결과를 반환하면서 *부작용이 없다*

입력을 받아 출력을 생성하는 블랙박스처럼, 인수가 같다면 반복호출시 항상 같은 결과를 반환

"함수형" = "수학의 함수처럼 부작용이 없는"

- 순수 함수형 프로그래밍 : 함수 그리고 if-then-else 등의 수학적 표현만 사용하는 방식
- 함수형 프로그래밍 : 시스템의 다른 부분에 영향을 미치지 않는다면 내부적으로는 함수형이 아닌 기능도 사용하는 방식

### 함수형 자바

실질적으론 자바로 순수 함수형 프로그래밍을 구현하기 어렵다. FP를 구현하고자 한다

- 함수나 메서드는 지역 변수만을 변경해야 한다
- 함수나 메서드에서 참조하는 객체가 있다면 그 객체는 불변이어야 한다
- 즉, 객체의 모든 필드가 final이어야 하고, 모든 참조 필드는 불변객체를 직접 참조해야한다
- 함수나 메서드가 어떤 예외도 일으키지 않아야 한다
- 비함수형 동작을 감출 수 있는 상황에서만 부작용을 포함하는 라이브러리를 사용해야 한다

### 참조 투명성 (Referential Transparency)

같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다면, 참조적으로 투명한 함수 !

ex) "seoul".replace('s', 'c')   ~~Random.nextInt~~   ~~Scanner.nextLine~~

- Extreme OOP ——————————— FP

사실은 프로그래밍 스펙트럼의 양 쪽에서 대치되는데, 자바는 둘을 혼합한다

- 상황에 따라, 순수함수로 복제할지 or 잠재적 버그를 찾는 시간을 소비하는 비용이 적을지 고려해 스스로 선택

    static List<List<Integer>> concat(List<List<Integer>> a, List<List<Integer>> b) {
    		a.addAll(b);
    		return a;
    }

    static List<List<Integer>> concat(List<List<Integer>> a, List<List<Integer>> b) {
    		List<List<Integer>> n = new ArrayList<>(a);
    		n.addAll(b);
    		return n;
    }

# 재귀와 반복

---

교재의 코드와 그림을 함께 봐야 이해될 것

4가지 방식의 팩토리얼 코드 예제 : 고전적인 for 루프, 재귀, 스트림, 꼬리 재귀

일반 재귀와 달리, 꼬리 재귀에선 컴파일러가 하나의 스택 프레임을 재활용할 가능성이 생긴다.

최신 JVM언어는 일반재귀를 꼬리재귀로 변환하는 최적화를 제공한다. 자바는 ㄴㄴ